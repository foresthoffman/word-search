function WordSearch(){}"undefined"==typeof jQuery&&(jQuery=require("./lib/jquery.min.js")),"undefined"!=typeof module&&(module.exports.WordSearch=WordSearch),WordSearch.prototype.init=function(r){this.WORD_GRID={},this.WORD_GRID_ROWS=[],this.WORDS_TO_MATCH=[],this.WORDS_TO_MATCH_TRIMMED=[],this._IS_ADVANCED_UPLOAD=this.draggable_exists(),this.UPLOADED_FILE_OBJ=null,this._LENGTH_OF_LONGEST_WORD=0,this._LENGTH_OF_SHORTEST_WORD=0,this._MAX_DIAGONAL_LENGTH=0,this._GRID_ROW_COUNT=0,this._GRID_ROW_LENGTH=0,this._DEFAULT_FILE_PATH=void 0!==r?r:"data/word-search.txt";this.loaded(this)},WordSearch.prototype.loaded=function(r){if(r.get_file_data(r._DEFAULT_FILE_PATH,r.reset_display,r),r._IS_ADVANCED_UPLOAD){var e=jQuery("#word_search_form .file_upload_box");e.addClass("has_advanced_upload");e.on("drag dragstart dragend dragover dragenter dragleave drop",function(r){r.preventDefault(),r.stopPropagation()}).on("dragover dragenter",function(){e.addClass("is_dragover")}).on("dragleave dragend drop",function(){e.removeClass("is_dragover")}).on("drop",function(e){var t=e.originalEvent.dataTransfer.files;r.update_form_file(t,r)})}jQuery("#word_search_form_file_upload").on("change",function(e){var t=e.currentTarget.files;r.update_form_file(t,r)});var t=jQuery("#form_method").val(),_=jQuery("#form_method .default_option").val();t!==_&&jQuery("#form_method").val(_),jQuery("#word_search_form #form_method").on("change",{self:r},r.change_form_display),jQuery(".spoiler").click(function(r){var e=r.currentTarget;jQuery(e).hasClass("spoil_toggled")?(jQuery(e).removeClass("spoil_toggled"),jQuery(e).siblings(".spoiler_target").hide()):(jQuery(e).addClass("spoil_toggled"),jQuery(e).siblings(".spoiler_target").show()),jQuery(e).children(".spoiler_container").toggle()}),jQuery("#submit").on("click",{self:r},r.get_form_data)},WordSearch.prototype.get_file_data=function(r,e,t){jQuery.ajax({url:r,success:function(r){e(r,"file",t)}})},WordSearch.prototype.get_form_data=function(r){r.preventDefault(),jQuery("#submit").prop("disabled",!0).val("Loading...");var e=r.data.self,t=jQuery("#word_search_form #form_method").val();if("upload"===t){var _=e.UPLOADED_FILE_OBJ;if(null!==_){var o=new FileReader;jQuery(o).on("loadend",function(){e.reset_display(o.result,"file",e)}),o.readAsText(_)}else e.reset_display("","file",e)}else if("manual"===t){var a=[jQuery("#word_search_form_textarea_grid").val(),jQuery("#word_search_form_textarea_list").val()];e.reset_display(a,"form",e)}},WordSearch.prototype.map_to_obj=function(r,e){var t={};if("file"===e){var _=r.split("\n\n===<BREAK>===\n\n");t={word_grid:_[0],word_list:_[1]}}else"form"===e&&(t={word_grid:r[0],word_list:r[1]});return t},WordSearch.prototype.reset_display=function(r,e,t){var _=t.map_to_obj(r,e);t.clear_alerts();var o=t.validate_data(_,e,t);if(0!==o.length)t.error_handler(o,t);else{var a=t.trim_inputs(_);t.prepare_search(a,t),t.create_display(),t.search_for_words(),jQuery("li.found").on("click",t.highlight_match),t.jump_to_id("top")}jQuery("#submit").prop("disabled",!1).val("Submit!")},WordSearch.prototype.sort_object_array=function(r,e){return e.word.length-r.word.length},WordSearch.prototype.find_obj_in_arr=function(r,e,t){var _=-1;if(void 0!==r||void 0!==e||void 0!==t)for(var o=0;o<r.length;o++)if(t===r[o][e]){_=o;break}return _},WordSearch.prototype.prepare_search=function(r,e){var t=r.word_grid,_=r.word_list,o=t.split("\n");e.WORD_GRID={},e.WORD_GRID_ROWS=[];for(var a=0;a<o.length;a++){var i=o[a].split(" ");e.WORD_GRID[a]=i,e.WORD_GRID_ROWS[a]=i.join(" ").replace(/[^\S\n]+/g,"")}e.WORDS_TO_MATCH=[],e.WORDS_TO_MATCH_TRIMMED=[];var s=_.split("\n");jQuery.each(s,function(r,t){e.WORDS_TO_MATCH.push({id:r,word:t}),e.WORDS_TO_MATCH_TRIMMED.push({id:r,word:t.replace(/[^\S\n]+/g,"")})}),e.WORDS_TO_MATCH.sort(e.sort_object_array);var d=e.WORDS_TO_MATCH_TRIMMED;d.sort(e.sort_object_array),e._LENGTH_OF_LONGEST_WORD=d[0].word.length,e._LENGTH_OF_SHORTEST_WORD=d[d.length-1].word.length,e._GRID_ROW_COUNT=Object.keys(e.WORD_GRID).length,e._GRID_ROW_LENGTH=e.WORD_GRID[0].length,e._MAX_DIAGONAL_LENGTH=Math.min(e._GRID_ROW_COUNT,e._GRID_ROW_LENGTH)},WordSearch.prototype.trim_inputs=function(r){if(void 0===r.word_grid||void 0===r.word_list)return{word_grid:"",word_list:""};var e=r.word_grid,t=r.word_list;return{word_grid:e.trim().replace(/([^\S\n]*[\'\"\-]+[^\S\n]*)+/g,"").replace(/(\n){2,}/g,"\n").replace(/\s+(?=\n)/g,"").replace(/\n[^\S\n]+(?=[a-zA-Z])/g,"\n").replace(/[^\S\n]+(?=[a-zA-Z])/g," ").replace(/([a-zA-Z]){2,}/g,function(r){return r.split("").join(" ")}).toUpperCase(),word_list:t.trim().replace(/([^\S\n]*[\'\"\-]+[^\S\n]*)+/g,"").replace(/(\n){2,}/g,"\n").replace(/\s+(?=\n)/g,"").replace(/\n[^\S\n]+(?=[a-zA-Z])/g,"\n").replace(/[^\S\n]+(?=[a-zA-Z])/g," ").toUpperCase()}},WordSearch.prototype.validate_data=function(r,e,t){var _=[],o=t.trim_inputs(r),a=o.word_grid,i=o.word_list,s=a.split("\n");if(void 0===o||void 0===a||void 0===i||""===a||""===i){if("file"===e)return _.push({field_type:"file",error_type:"invalid"}),_;"form"===e&&(void 0!==a&&""!==a||_.push({field_type:"grid",error_type:"empty"}),void 0!==i&&""!==i||_.push({field_type:"list",error_type:"empty"}))}a.match(/[^a-zA-Z\s]/)&&_.push({field_type:"grid",error_type:"non-alpha"}),i.match(/[^a-zA-Z\s]/)&&_.push({field_type:"list",error_type:"non-alpha"});for(var d=0;d<s.length;d++)if(s[d].length!==s[0].length){_.push({field_type:"grid",error_type:"row-length"});break}return _},WordSearch.prototype.error_handler=function(r,e){if(0!==r.length)for(var t=0;t<r.length;t++){var _=r[t],o="";switch(_.field_type){case"grid":"row-length"===_.error_type?(o="There is an issue with the grid field! Make sure that the grid rows are all the same length.",jQuery('#word_search_form label[for="word_grid"]').addClass("error")):"empty"===_.error_type?(o="The grid field must be filled.",jQuery('#word_search_form label[for="word_grid"]').addClass("error")):"non-alpha"===_.error_type&&(o="The grid field may only contain alphabetical characters, spaces, dashes, apostrophes, and quotes.",jQuery('#word_search_form label[for="word_grid"]').addClass("error"));break;case"list":"empty"===_.error_type?(o="The list field must be filled.",jQuery('#word_search_form label[for="word_list"]').addClass("error")):"non-alpha"===_.error_type&&(o="The list field may only contain alphabetical characters, spaces, dashes, apostrophes, and quotes.",jQuery('#word_search_form label[for="word_list"]').addClass("error"));break;case"file":"invalid"===_.error_type&&(o="The input is invalid. Please submit a file with the proper formatting (see below for formatting rules).",jQuery('#word_search_form label[for="word_file"]').addClass("error"))}jQuery("#word_search_form #alert_list").append("<li>"+o+"</li>"),jQuery("#word_search_form #alert_area").show(),e.jump_to_id("alert_area")}},WordSearch.prototype.highlight_match=function(r){var e=jQuery(r.currentTarget).attr("data-match-index"),t=jQuery("#word_table_container .table_data").eq(e),_='li.found[data-match-index="'+e+'"]',o=jQuery(_).length>1;jQuery(t).hasClass("highlight_match")?(jQuery(t).removeClass("highlight_match"),jQuery(_).children().removeClass("highlight_toggle")):(jQuery(t).addClass("highlight_match"),jQuery(r.currentTarget).children().addClass("highlight_toggle"),o&&jQuery(r.currentTarget).siblings(_).children().addClass("highlight_toggle"))},WordSearch.prototype.found_word=function(r,e,t,_){for(var o=0;o<t;o++)switch(_){case"row":jQuery("#word_table_container td").eq(e+o+this._GRID_ROW_LENGTH*r).addClass("row_match");break;case"column":jQuery("#word_table_container td").eq(e+this._GRID_ROW_LENGTH*(r+o)).addClass("column_match");break;case"diagonal-right":jQuery("#word_table_container td").eq(e+o+this._GRID_ROW_LENGTH*(r+o)).addClass("diagonal_match");break;case"diagonal-left":jQuery("#word_table_container td").eq(e+(this._GRID_ROW_LENGTH*(r+o)-o)).addClass("diagonal_match");break;default:return}},WordSearch.prototype.remove_word_from_list=function(r,e,t){var _=t+this._GRID_ROW_LENGTH*e,o=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",r),a=this.find_obj_in_arr(this.WORDS_TO_MATCH_TRIMMED,"id",r);jQuery("#word_list_container li:contains("+this.WORDS_TO_MATCH[o].word+")").addClass("found").attr("data-match-index",_);this.WORDS_TO_MATCH.splice(o,1),this.WORDS_TO_MATCH_TRIMMED.splice(a,1)},WordSearch.prototype.search_for_words=function(){console.log("################## Searching...");var r=this.WORDS_TO_MATCH_TRIMMED.length,e=Date.now();this.search_row(),this.search_column(),this.search_diagonal();var t=Date.now()-e,_=r-this.WORDS_TO_MATCH_TRIMMED.length;console.log("################## All done! ("+_+"/"+r+" found, "+t+"ms)")},WordSearch.prototype.search_row=function(){for(var r=0;r<this.WORD_GRID_ROWS.length;r++){for(var e=0;e<this.WORDS_TO_MATCH_TRIMMED.length;e++){var t=this.WORDS_TO_MATCH_TRIMMED[e].word,_=this.WORDS_TO_MATCH_TRIMMED[e].id,o=this.WORD_GRID_ROWS[r].indexOf(t);if(-1!==o){var a=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",_),i=this.WORDS_TO_MATCH[a].word;console.log('Horizontal match for "'+i+'" on row '+(r+1)+" starting at letter #"+(o+1)),this.found_word(r,o,i.length,"row","#54A9CC"),this.remove_word_from_list(_,r,o),e--}}for(var s=0;s<this.WORDS_TO_MATCH_TRIMMED.length;s++){var d=this.WORDS_TO_MATCH_TRIMMED[s].word,l=this.WORDS_TO_MATCH_TRIMMED[s].id,n=d.split("").reverse().join(""),h=this.WORD_GRID_ROWS[r].indexOf(n);if(-1!==h){var f=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",l),O=this.WORDS_TO_MATCH[f].word;console.log('Horizontal match (reversed) for "'+O+'" on row '+(r+1)+" ending at letter #"+(h+1)),this.found_word(r,h,O.length,"row","#54A9CC"),this.remove_word_from_list(l,r,h),s--}}}},WordSearch.prototype.search_column=function(){for(var r=0;r<this.WORD_GRID_ROWS[0].length;r++){for(var e="",t=0;t<Object.keys(this.WORD_GRID).length;t++)e+=this.WORD_GRID[t][r];for(var _=0;_<this.WORDS_TO_MATCH_TRIMMED.length;_++){var o=this.WORDS_TO_MATCH_TRIMMED[_].word,a=this.WORDS_TO_MATCH_TRIMMED[_].id,i=e.indexOf(o);if(-1!==i){var s=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",a),d=this.WORDS_TO_MATCH[s].word;console.log('Vertical match for "'+d+'" on row '+(i+1)+" starting at letter #"+(r+1)),this.found_word(i,r,d.length,"column","#EEEEEE"),this.remove_word_from_list(a,i,r),_--}}for(var l=0;l<this.WORDS_TO_MATCH_TRIMMED.length;l++){var n=this.WORDS_TO_MATCH_TRIMMED[l].word,h=this.WORDS_TO_MATCH_TRIMMED[l].id,f=n.split("").reverse().join(""),O=e.indexOf(f);if(-1!==O){var c=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",h),T=this.WORDS_TO_MATCH[c].word;console.log('Vertical match (reversed) for "'+T+'" on row '+(O+1)+" ending at letter #"+(r+1)),this.found_word(O,r,T.length,"column","#EEEEEE"),this.remove_word_from_list(h,O,r),l--}}}},WordSearch.prototype.search_diagonal=function(){if(this._MAX_DIAGONAL_LENGTH<this._LENGTH_OF_SHORTEST_WORD)console.log("Not enough space to search diagonally.");else for(var r=0;r<Object.keys(this.WORD_GRID).length;r++)for(var e=0;e<this.WORD_GRID[r].length;e++){var t="",_="",o=0;if(this._GRID_ROW_LENGTH-e>=this._LENGTH_OF_LONGEST_WORD&&this._GRID_ROW_COUNT-r>=this._LENGTH_OF_LONGEST_WORD?o=this._LENGTH_OF_LONGEST_WORD:this._GRID_ROW_LENGTH-e>=this._LENGTH_OF_SHORTEST_WORD&&this._GRID_ROW_COUNT-r>=this._LENGTH_OF_SHORTEST_WORD&&(o=Math.min(this._GRID_ROW_LENGTH-e,this._GRID_ROW_COUNT-r)),o>0){for(var a=0;a<o;a++)t+=this.WORD_GRID[r+a][e+a];for(var i=0;i<this.WORDS_TO_MATCH_TRIMMED.length;i++){var s=this.WORDS_TO_MATCH_TRIMMED[i].word,d=this.WORDS_TO_MATCH_TRIMMED[i].id,l=t.indexOf(s);if(-1!==l){var n=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",d),h=this.WORDS_TO_MATCH[n].word;console.log('Diagonal match (down and right) for "'+h+'" on row '+(r+1+l)+" starting at letter #"+(e+1+l)),this.found_word(r+l,e+l,h.length,"diagonal-right","#DB2406"),this.remove_word_from_list(d,r+l,e+l),i--}}for(var f=0;f<this.WORDS_TO_MATCH_TRIMMED.length;f++){var O=this.WORDS_TO_MATCH_TRIMMED[f].word,c=this.WORDS_TO_MATCH_TRIMMED[f].id,T=O.split("").reverse().join(""),R=t.indexOf(T);if(-1!==R){var u=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",c),D=this.WORDS_TO_MATCH[u].word;console.log('Diagonal match (reversed, down and right) for "'+D+'" on row '+(r+1+R)+" ending at letter #"+(e+1+R)),this.found_word(r+R,e+R,D.length,"diagonal-right","#DB2406"),this.remove_word_from_list(c,r+R,e+R),f--}}}if(o=0,e>=this._LENGTH_OF_LONGEST_WORD&&this._GRID_ROW_COUNT-r>=this._LENGTH_OF_LONGEST_WORD?o=this._LENGTH_OF_LONGEST_WORD:e>=this._LENGTH_OF_SHORTEST_WORD&&this._GRID_ROW_COUNT-r>=this._LENGTH_OF_SHORTEST_WORD&&(o=Math.min(e,this._GRID_ROW_COUNT-r)),o>0){for(var p=0;p<o;p++)_+=this.WORD_GRID[r+p][e-p];for(var g=0;g<this.WORDS_TO_MATCH_TRIMMED.length;g++){var W=this.WORDS_TO_MATCH_TRIMMED[g].word,m=this.WORDS_TO_MATCH_TRIMMED[g].id,w=_.indexOf(W);if(-1!==w){var y=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",m),v=this.WORDS_TO_MATCH[y].word;console.log('Diagonal match (reversed, down and left) for "'+v+'" on row '+(r+1+w)+" starting at letter #"+(e+1-w)),this.found_word(r+w,e-w,v.length,"diagonal-left","#DB2406"),this.remove_word_from_list(m,r+w,e-w),g--}}for(var M=0;M<this.WORDS_TO_MATCH_TRIMMED.length;M++){var S=this.WORDS_TO_MATCH_TRIMMED[M].word,E=this.WORDS_TO_MATCH_TRIMMED[M].id,C=S.split("").reverse().join(""),H=_.indexOf(C);if(-1!==H){var j=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",E),A=this.WORDS_TO_MATCH[j].word;console.log('Diagonal match (down and left) for "'+A+'" on row '+(r+1+H)+" starting at letter #"+(e+1-H)),this.found_word(r+H,e-H,A.length,"diagonal-left","#DB2406"),this.remove_word_from_list(E,r+H,e-H),M--}}}}},WordSearch.prototype.create_display=function(){var r="",e="";r+='<table><tr><th class="table_header"></th>';for(var t=1;t<=this._GRID_ROW_LENGTH;t++)r+='<th class="table_header">'+t+"</th>";r+="</tr>",jQuery.each(this.WORD_GRID,function(e,t){r+='<tr><th class="table_header">'+(parseInt(e)+1)+"</th>",jQuery.each(t,function(e,t){r+='<td class="table_data">'+t+"</td>"}),r+="</tr>"}),r+="</table>",jQuery("#word_table_container").html(r),e+="<ol>";for(var _=0;_<this.WORDS_TO_MATCH.length;_++)e+="<li><span>"+this.WORDS_TO_MATCH[_].word+"</span></li>";e+="</ol>",jQuery("#word_list_container").html(e)},WordSearch.prototype.update_form_file=function(r,e){if(void 0!==r[0]){var t=r[0],_=t.name;jQuery("#word_search_form_file_upload")[0];jQuery('.file_upload_input label[for="word_search_form_file_upload"]').html(_),e.UPLOADED_FILE_OBJ=t}},WordSearch.prototype.change_form_display=function(r){var e=r.data.self,t=r.currentTarget.value;e.clear_alerts(),"upload"===t?(jQuery("#form_manual_method").hide(),jQuery("#form_upload_method").show()):"manual"===t&&(jQuery("#form_upload_method").hide(),jQuery("#form_manual_method").show())},WordSearch.prototype.draggable_exists=function(){var r=document.createElement("div"),e="FileReader"in window,t="FormData"in window;return!(!("draggable"in r)&&!("ondragstart"in r&&"ondrop"in r)||!e||!t)},WordSearch.prototype.clear_alerts=function(){jQuery("#word_search_form label").removeClass("error"),jQuery("#word_search_form #alert_area").hide(),jQuery("#word_search_form #alert_list").html("")},WordSearch.prototype.jump_to_id=function(r){if(""!==r){var e=r.replace(/^(#)*/,"");window.location.hash="",window.location.hash=e}};