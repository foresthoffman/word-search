function WordSearch(){}"undefined"==typeof jQuery&&(jQuery=require("./lib/jquery-1.11.3.min.js")),"undefined"!=typeof module&&(module.exports.WordSearch=WordSearch),WordSearch.prototype.init=function(a){this.WORD_GRID={},this.WORD_GRID_ROWS=[],this.WORDS_TO_MATCH=[],this.WORDS_TO_MATCH_TRIMMED=[],this._IS_ADVANCED_UPLOAD=this.draggable_exists(),this.UPLOADED_FILE_OBJ=null,this._LENGTH_OF_LONGEST_WORD=0,this._LENGTH_OF_SHORTEST_WORD=0,this._MAX_DIAGONAL_LENGTH=0,this._GRID_ROW_COUNT=0,this._GRID_ROW_LENGTH=0,this._DEFAULT_FILE_PATH="undefined"!=typeof a?a:"data/word-search.txt";var b=this;this.loaded(b)},WordSearch.prototype.loaded=function(a){if(a.get_file_data(a._DEFAULT_FILE_PATH,a.reset_display,a),a._IS_ADVANCED_UPLOAD){var b=jQuery("#word_search_form .file_upload_box");b.addClass("has_advanced_upload");b.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){b.addClass("is_dragover")}).on("dragleave dragend drop",function(){b.removeClass("is_dragover")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;a.update_form_file(c,a)})}jQuery("#word_search_form_file_upload").on("change",function(b){var c=b.currentTarget.files;a.update_form_file(c,a)});var c=jQuery("#form_method").val(),d=jQuery("#form_method .default_option").val();c!==d&&jQuery("#form_method").val(d),jQuery("#word_search_form #form_method").on("change",{self:a},a.change_form_display),jQuery(".spoiler").click(function(a){var b=a.currentTarget;jQuery(b).hasClass("spoil_toggled")?(jQuery(b).removeClass("spoil_toggled"),jQuery(b).siblings(".spoiler_target").hide()):(jQuery(b).addClass("spoil_toggled"),jQuery(b).siblings(".spoiler_target").show()),jQuery(b).children(".spoiler_container").toggle()}),jQuery("#submit").on("click",{self:a},a.get_form_data)},WordSearch.prototype.get_file_data=function(a,b,c){jQuery.ajax({url:a,success:function(a){b(a,"file",c)}})},WordSearch.prototype.get_form_data=function(a){a.preventDefault(),jQuery("#submit").prop("disabled",!0).val("Loading...");var b=a.data.self,c=jQuery("#word_search_form #form_method").val();if("upload"===c){var d=b.UPLOADED_FILE_OBJ;if(null!==d){var e=new FileReader;jQuery(e).on("loadend",function(){b.reset_display(e.result,"file",b)}),e.readAsText(d)}else b.reset_display("","file",b)}else if("manual"===c){var f=jQuery("#word_search_form_textarea_grid").val(),g=jQuery("#word_search_form_textarea_list").val(),h=[f,g];b.reset_display(h,"form",b)}},WordSearch.prototype.map_to_obj=function(a,b){var c={};if("file"===b){var d=a.split("\n\n===<BREAK>===\n\n");c={word_grid:d[0],word_list:d[1]}}else"form"===b&&(c={word_grid:a[0],word_list:a[1]});return c},WordSearch.prototype.reset_display=function(a,b,c){var d=c.map_to_obj(a,b);c.clear_alerts();var e=c.validate_data(d,b,c);if(0!==e.length)c.error_handler(e,c);else{var f=c.trim_inputs(d);c.prepare_search(f,c),c.create_display(),c.search_for_words(),jQuery("li.found").on("click",c.highlight_match),c.jump_to_id("top")}jQuery("#submit").prop("disabled",!1).val("Submit!")},WordSearch.prototype.sort_object_array=function(a,b){return b.word.length-a.word.length},WordSearch.prototype.find_obj_in_arr=function(a,b,c){var d=-1;if("undefined"!=typeof a||"undefined"!=typeof b||"undefined"!=typeof c)for(var e=0;e<a.length;e++)if(c===a[e][b]){d=e;break}return d},WordSearch.prototype.prepare_search=function(a,b){var c=a.word_grid,d=a.word_list,e=c.split("\n");b.WORD_GRID={},b.WORD_GRID_ROWS=[];for(var f=0;f<e.length;f++){var g=e[f].split(" ");b.WORD_GRID[f]=g,b.WORD_GRID_ROWS[f]=g.join(" ").replace(/[^\S\n]+/g,"")}b.WORDS_TO_MATCH=[],b.WORDS_TO_MATCH_TRIMMED=[];var h=d.split("\n");jQuery.each(h,function(a,c){b.WORDS_TO_MATCH.push({id:a,word:c}),b.WORDS_TO_MATCH_TRIMMED.push({id:a,word:c.replace(/[^\S\n]+/g,"")})});var i=b.WORDS_TO_MATCH;i.sort(b.sort_object_array);var j=b.WORDS_TO_MATCH_TRIMMED;j.sort(b.sort_object_array),b._LENGTH_OF_LONGEST_WORD=j[0].word.length,b._LENGTH_OF_SHORTEST_WORD=j[j.length-1].word.length,b._GRID_ROW_COUNT=Object.keys(b.WORD_GRID).length,b._GRID_ROW_LENGTH=b.WORD_GRID[0].length,b._MAX_DIAGONAL_LENGTH=Math.min(b._GRID_ROW_COUNT,b._GRID_ROW_LENGTH)},WordSearch.prototype.trim_inputs=function(a){if("undefined"==typeof a.word_grid||"undefined"==typeof a.word_list)return{word_grid:"",word_list:""};var b=a.word_grid,c=a.word_list,d=b.trim().replace(/([^\S\n]*[\'\"\-]+[^\S\n]*)+/g,"").replace(/(\n){2,}/g,"\n").replace(/\s+(?=\n)/g,"").replace(/\n[^\S\n]+(?=[a-zA-Z])/g,"\n").replace(/[^\S\n]+(?=[a-zA-Z])/g," ").replace(/([a-zA-Z]){2,}/g,function(a){return a.split("").join(" ")}).toUpperCase(),e=c.trim().replace(/([^\S\n]*[\'\"\-]+[^\S\n]*)+/g,"").replace(/(\n){2,}/g,"\n").replace(/\s+(?=\n)/g,"").replace(/\n[^\S\n]+(?=[a-zA-Z])/g,"\n").replace(/[^\S\n]+(?=[a-zA-Z])/g," ").toUpperCase();return{word_grid:d,word_list:e}},WordSearch.prototype.validate_data=function(a,b,c){var d=[],e=c.trim_inputs(a),f=e.word_grid,g=e.word_list,h=f.split("\n");if("undefined"==typeof e||"undefined"==typeof f||"undefined"==typeof g||""===f||""===g){if("file"===b)return d.push({field_type:"file",error_type:"invalid"}),d;"form"===b&&(("undefined"==typeof f||""===f)&&d.push({field_type:"grid",error_type:"empty"}),("undefined"==typeof g||""===g)&&d.push({field_type:"list",error_type:"empty"}))}f.match(/[^a-zA-Z\s]/)&&d.push({field_type:"grid",error_type:"non-alpha"}),g.match(/[^a-zA-Z\s]/)&&d.push({field_type:"list",error_type:"non-alpha"});for(var i=0;i<h.length;i++)if(h[i].length!==h[0].length){d.push({field_type:"grid",error_type:"row-length"});break}return d},WordSearch.prototype.error_handler=function(a,b){if(0!==a.length)for(var c=0;c<a.length;c++){var d=a[c],e="";switch(d.field_type){case"grid":"row-length"===d.error_type?(e="There is an issue with the grid field! Make sure that the grid rows are all the same length.",jQuery('#word_search_form label[for="word_grid"]').addClass("error")):"empty"===d.error_type?(e="The grid field must be filled.",jQuery('#word_search_form label[for="word_grid"]').addClass("error")):"non-alpha"===d.error_type&&(e="The grid field may only contain alphabetical characters, spaces, dashes, apostrophes, and quotes.",jQuery('#word_search_form label[for="word_grid"]').addClass("error"));break;case"list":"empty"===d.error_type?(e="The list field must be filled.",jQuery('#word_search_form label[for="word_list"]').addClass("error")):"non-alpha"===d.error_type&&(e="The list field may only contain alphabetical characters, spaces, dashes, apostrophes, and quotes.",jQuery('#word_search_form label[for="word_list"]').addClass("error"));break;case"file":"invalid"===d.error_type&&(e="The input is invalid. Please submit a file with the proper formatting (see below for formatting rules).",jQuery('#word_search_form label[for="word_file"]').addClass("error"))}jQuery("#word_search_form #alert_list").append("<li>"+e+"</li>"),jQuery("#word_search_form #alert_area").show(),b.jump_to_id("alert_area")}},WordSearch.prototype.highlight_match=function(a){var b=jQuery(a.currentTarget).attr("data-match-index"),c=jQuery("#word_table_container .table_data").eq(b),d='li.found[data-match-index="'+b+'"]',e=jQuery(d).length>1?!0:!1;jQuery(c).hasClass("highlight_match")?(jQuery(c).removeClass("highlight_match"),jQuery(d).children().removeClass("highlight_toggle")):(jQuery(c).addClass("highlight_match"),jQuery(a.currentTarget).children().addClass("highlight_toggle"),e&&jQuery(a.currentTarget).siblings(d).children().addClass("highlight_toggle"))},WordSearch.prototype.found_word=function(a,b,c,d){for(var e=0;c>e;e++)switch(d){case"row":jQuery("#word_table_container td").eq(b+e+this._GRID_ROW_LENGTH*a).addClass("row_match");break;case"column":jQuery("#word_table_container td").eq(b+this._GRID_ROW_LENGTH*(a+e)).addClass("column_match");break;case"diagonal-right":jQuery("#word_table_container td").eq(b+e+this._GRID_ROW_LENGTH*(a+e)).addClass("diagonal_match");break;case"diagonal-left":jQuery("#word_table_container td").eq(b+(this._GRID_ROW_LENGTH*(a+e)-e)).addClass("diagonal_match");break;default:return}},WordSearch.prototype.remove_word_from_list=function(a,b,c){var d=c+this._GRID_ROW_LENGTH*b,e=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",a),f=this.find_obj_in_arr(this.WORDS_TO_MATCH_TRIMMED,"id",a);jQuery("#word_list_container li:contains("+this.WORDS_TO_MATCH[e].word+")").addClass("found").attr("data-match-index",d);this.WORDS_TO_MATCH.splice(e,1),this.WORDS_TO_MATCH_TRIMMED.splice(f,1)},WordSearch.prototype.search_for_words=function(){console.log("################## Searching...");var a=this.WORDS_TO_MATCH_TRIMMED.length,b=Date.now();this.search_row(),this.search_column(),this.search_diagonal();var c=Date.now()-b,d=a-this.WORDS_TO_MATCH_TRIMMED.length;console.log("################## All done! ("+d+"/"+a+" found, "+c+"ms)")},WordSearch.prototype.search_row=function(){for(var a=0;a<this.WORD_GRID_ROWS.length;a++){for(var b=0;b<this.WORDS_TO_MATCH_TRIMMED.length;b++){var c=this.WORDS_TO_MATCH_TRIMMED[b].word,d=this.WORDS_TO_MATCH_TRIMMED[b].id,e=this.WORD_GRID_ROWS[a].indexOf(c);if(-1!==e){var f=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",d),g=this.WORDS_TO_MATCH[f].word;console.log('Horizontal match for "'+g+'" on row '+(a+1)+" starting at letter #"+(e+1)),this.found_word(a,e,g.length,"row","#54A9CC"),this.remove_word_from_list(d,a,e),b--}}for(var h=0;h<this.WORDS_TO_MATCH_TRIMMED.length;h++){var i=this.WORDS_TO_MATCH_TRIMMED[h].word,j=this.WORDS_TO_MATCH_TRIMMED[h].id,k=i.split("").reverse().join(""),l=this.WORD_GRID_ROWS[a].indexOf(k);if(-1!==l){var m=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",j),n=this.WORDS_TO_MATCH[m].word;console.log('Horizontal match (reversed) for "'+n+'" on row '+(a+1)+" ending at letter #"+(l+1)),this.found_word(a,l,n.length,"row","#54A9CC"),this.remove_word_from_list(j,a,l),h--}}}},WordSearch.prototype.search_column=function(){for(var a=0;a<this.WORD_GRID_ROWS[0].length;a++){for(var b="",c=0;c<Object.keys(this.WORD_GRID).length;c++)b+=this.WORD_GRID[c][a];for(var d=0;d<this.WORDS_TO_MATCH_TRIMMED.length;d++){var e=this.WORDS_TO_MATCH_TRIMMED[d].word,f=this.WORDS_TO_MATCH_TRIMMED[d].id,g=b.indexOf(e);if(-1!==g){var h=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",f),i=this.WORDS_TO_MATCH[h].word;console.log('Vertical match for "'+i+'" on row '+(g+1)+" starting at letter #"+(a+1)),this.found_word(g,a,i.length,"column","#EEEEEE"),this.remove_word_from_list(f,g,a),d--}}for(var j=0;j<this.WORDS_TO_MATCH_TRIMMED.length;j++){var k=this.WORDS_TO_MATCH_TRIMMED[j].word,l=this.WORDS_TO_MATCH_TRIMMED[j].id,m=k.split("").reverse().join(""),n=b.indexOf(m);if(-1!==n){var o=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",l),p=this.WORDS_TO_MATCH[o].word;console.log('Vertical match (reversed) for "'+p+'" on row '+(n+1)+" ending at letter #"+(a+1)),this.found_word(n,a,p.length,"column","#EEEEEE"),this.remove_word_from_list(l,n,a),j--}}}},WordSearch.prototype.search_diagonal=function(){if(this._MAX_DIAGONAL_LENGTH<this._LENGTH_OF_SHORTEST_WORD)return void console.log("Not enough space to search diagonally.");for(var a=0;a<Object.keys(this.WORD_GRID).length;a++)for(var b=0;b<this.WORD_GRID[a].length;b++){var c="",d="",e=0;if(this._GRID_ROW_LENGTH-b>=this._LENGTH_OF_LONGEST_WORD&&this._GRID_ROW_COUNT-a>=this._LENGTH_OF_LONGEST_WORD?e=this._LENGTH_OF_LONGEST_WORD:this._GRID_ROW_LENGTH-b>=this._LENGTH_OF_SHORTEST_WORD&&this._GRID_ROW_COUNT-a>=this._LENGTH_OF_SHORTEST_WORD&&(e=Math.min(this._GRID_ROW_LENGTH-b,this._GRID_ROW_COUNT-a)),e>0){for(var f=0;e>f;f++)c+=this.WORD_GRID[a+f][b+f];for(var g=0;g<this.WORDS_TO_MATCH_TRIMMED.length;g++){var h=this.WORDS_TO_MATCH_TRIMMED[g].word,i=this.WORDS_TO_MATCH_TRIMMED[g].id,j=c.indexOf(h);if(-1!==j){var k=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",i),l=this.WORDS_TO_MATCH[k].word;console.log('Diagonal match (down and right) for "'+l+'" on row '+(a+1+j)+" starting at letter #"+(b+1+j)),this.found_word(a+j,b+j,l.length,"diagonal-right","#DB2406"),this.remove_word_from_list(i,a+j,b+j),g--}}for(var m=0;m<this.WORDS_TO_MATCH_TRIMMED.length;m++){var n=this.WORDS_TO_MATCH_TRIMMED[m].word,o=this.WORDS_TO_MATCH_TRIMMED[m].id,p=n.split("").reverse().join(""),q=c.indexOf(p);if(-1!==q){var r=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",o),s=this.WORDS_TO_MATCH[r].word;console.log('Diagonal match (reversed, down and right) for "'+s+'" on row '+(a+1+q)+" ending at letter #"+(b+1+q)),this.found_word(a+q,b+q,s.length,"diagonal-right","#DB2406"),this.remove_word_from_list(o,a+q,b+q),m--}}}if(e=0,b>=this._LENGTH_OF_LONGEST_WORD&&this._GRID_ROW_COUNT-a>=this._LENGTH_OF_LONGEST_WORD?e=this._LENGTH_OF_LONGEST_WORD:b>=this._LENGTH_OF_SHORTEST_WORD&&this._GRID_ROW_COUNT-a>=this._LENGTH_OF_SHORTEST_WORD&&(e=Math.min(b,this._GRID_ROW_COUNT-a)),e>0){for(var t=0;e>t;t++)d+=this.WORD_GRID[a+t][b-t];for(var u=0;u<this.WORDS_TO_MATCH_TRIMMED.length;u++){var v=this.WORDS_TO_MATCH_TRIMMED[u].word,w=this.WORDS_TO_MATCH_TRIMMED[u].id,x=d.indexOf(v);if(-1!==x){var y=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",w),z=this.WORDS_TO_MATCH[y].word;console.log('Diagonal match (reversed, down and left) for "'+z+'" on row '+(a+1+x)+" starting at letter #"+(b+1-x)),this.found_word(a+x,b-x,z.length,"diagonal-left","#DB2406"),this.remove_word_from_list(w,a+x,b-x),u--}}for(var A=0;A<this.WORDS_TO_MATCH_TRIMMED.length;A++){var B=this.WORDS_TO_MATCH_TRIMMED[A].word,C=this.WORDS_TO_MATCH_TRIMMED[A].id,D=B.split("").reverse().join(""),E=d.indexOf(D);if(-1!==E){var F=this.find_obj_in_arr(this.WORDS_TO_MATCH,"id",C),G=this.WORDS_TO_MATCH[F].word;console.log('Diagonal match (down and left) for "'+G+'" on row '+(a+1+E)+" starting at letter #"+(b+1-E)),this.found_word(a+E,b-E,G.length,"diagonal-left","#DB2406"),this.remove_word_from_list(C,a+E,b-E),A--}}}}},WordSearch.prototype.create_display=function(){var a="",b="";a+='<table><tr><th class="table_header"></th>';for(var c=1;c<=this._GRID_ROW_LENGTH;c++)a+='<th class="table_header">'+c+"</th>";a+="</tr>",jQuery.each(this.WORD_GRID,function(b,c){a+='<tr><th class="table_header">'+(parseInt(b)+1)+"</th>",jQuery.each(c,function(b,c){a+='<td class="table_data">'+c+"</td>"}),a+="</tr>"}),a+="</table>",jQuery("#word_table_container").html(a),b+="<ol>";for(var d=0;d<this.WORDS_TO_MATCH.length;d++)b+="<li><span>"+this.WORDS_TO_MATCH[d].word+"</span></li>";b+="</ol>",jQuery("#word_list_container").html(b)},WordSearch.prototype.update_form_file=function(a,b){if("undefined"!=typeof a[0]){var c=a[0],d=c.name;jQuery("#word_search_form_file_upload")[0];jQuery('.file_upload_input label[for="word_search_form_file_upload"]').html(d),b.UPLOADED_FILE_OBJ=c}},WordSearch.prototype.change_form_display=function(a){var b=a.data.self,c=a.currentTarget.value;b.clear_alerts(),"upload"===c?(jQuery("#form_manual_method").hide(),jQuery("#form_upload_method").show()):"manual"===c&&(jQuery("#form_upload_method").hide(),jQuery("#form_manual_method").show())},WordSearch.prototype.draggable_exists=function(){var a=document.createElement("div"),b="draggable"in a,c="ondragstart"in a&&"ondrop"in a,d="FileReader"in window,e="FormData"in window;return(b||c)&&d&&e?!0:!1},WordSearch.prototype.clear_alerts=function(){jQuery("#word_search_form label").removeClass("error"),jQuery("#word_search_form #alert_area").hide(),jQuery("#word_search_form #alert_list").html("")},WordSearch.prototype.jump_to_id=function(a){if(""!==a){var b=a.replace(/^(#)*/,"");window.location.hash="",window.location.hash=b}};